import{_ as e,c as a,o as s,ag as t}from"./chunks/framework.DH_Cy_iG.js";const k=JSON.parse('{"title":"Modifier Type Generation","description":"","frontmatter":{},"headers":[],"relativePath":"guide/modifier-type-generation.md","filePath":"guide/modifier-type-generation.md"}'),n={name:"guide/modifier-type-generation.md"};function r(o,i,l,h,p,d){return s(),a("div",null,[...i[0]||(i[0]=[t(`<h1 id="modifier-type-generation" tabindex="-1">Modifier Type Generation <a class="header-anchor" href="#modifier-type-generation" aria-label="Permalink to &quot;Modifier Type Generation&quot;">​</a></h1><p>TachUI ships tooling that keeps the fluent modifier chain API in sync with the registry metadata. This page explains when to run the generator, how to wire it into CI, and the options available for multi-package workspaces.</p><h2 id="when-to-regenerate" tabindex="-1">When to Regenerate <a class="header-anchor" href="#when-to-regenerate" aria-label="Permalink to &quot;When to Regenerate&quot;">​</a></h2><p>You <strong>must</strong> regenerate modifier declarations whenever you:</p><ul><li>Add, remove, or rename a modifier</li><li>Update modifier metadata (description, category, priority, signature)</li><li>Introduce a new plugin that registers modifiers</li></ul><p>Regeneration writes two files inside each package:</p><ul><li><code>src/types/generated-modifiers.d.ts</code> — declaration merge that augments <code>ModifierBuilder</code> and <code>ModifiableComponent</code></li><li><code>src/types/modifier-metadata.snapshot.json</code> — machine-readable snapshot used by CLI tooling (e.g., conflict reporting)</li></ul><p>Both files should be committed when they change.</p><h2 id="core-commands" tabindex="-1">Core Commands <a class="header-anchor" href="#core-commands" aria-label="Permalink to &quot;Core Commands&quot;">​</a></h2><p>From the repository root:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --filter</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @tachui/core</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> generate-modifier-types</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Verify that declarations are up to date (CI-friendly)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --filter</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @tachui/core</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> generate-modifier-types</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --check</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Treat conflicts as build failures</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --filter</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @tachui/core</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> generate-modifier-types</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --check</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --fail-on-conflict</span></span></code></pre></div><h3 id="watching-during-development" tabindex="-1">Watching During Development <a class="header-anchor" href="#watching-during-development" aria-label="Permalink to &quot;Watching During Development&quot;">​</a></h3><p>The generator can watch source files and re-emit declarations on change:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --filter</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @tachui/core</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> generate-modifier-types</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --watch</span></span></code></pre></div><p>This is useful when you are iterating on modifier signatures or metadata and want instant feedback from the declaration file/IDE.</p><h3 id="monorepo-generation" tabindex="-1">Monorepo Generation <a class="header-anchor" href="#monorepo-generation" aria-label="Permalink to &quot;Monorepo Generation&quot;">​</a></h3><p>To regenerate multiple packages in a single pass, use the monorepo helper:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Generates types for the core, forms, and navigation packages</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --filter</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @tachui/core</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> generate-modifier-types:monorepo</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --packages</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> core,forms,navigation</span></span></code></pre></div><p>You can append <code>--fail-on-conflict</code> to the monorepo script as well.</p><h3 id="why-this-script-lives-in-tachui-core" tabindex="-1">Why this script lives in <code>@tachui/core</code> <a class="header-anchor" href="#why-this-script-lives-in-tachui-core" aria-label="Permalink to &quot;Why this script lives in \`@tachui/core\`&quot;">​</a></h3><p>The generator ships with <code>@tachui/core</code> because it produces and verifies the type declarations that the core package publishes. Keeping the script colocated avoids cross-package dependency loops (for example, pulling the CLI into the core build) and guarantees the generator always runs against the same registry implementation and metadata that the core package uses at build time.</p><h2 id="vite-integration" tabindex="-1">Vite Integration <a class="header-anchor" href="#vite-integration" aria-label="Permalink to &quot;Vite Integration&quot;">​</a></h2><p>Projects that run a Vite build (or dev server) can let the toolchain manage type generation automatically via the bundled plugin:</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// vite.config.ts</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { defineConfig } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vite&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { modifierTypesPlugin } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@tachui/core/build-plugins&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  plugins: [</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    modifierTypesPlugin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // Optional: fail the build if conflicts are detected</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      failOnConflict: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // Optional: provide additional hydrators if you register modifiers outside core/modifiers/devtools</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      extraHydrators: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;../my-plugin/src/metadata.ts&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><p>The plugin regenerates declarations on <code>buildStart</code> and during Vite’s file watcher cycle. Debouncing is built in to avoid excessive regeneration.</p><h2 id="hydrators-and-metadata-sources" tabindex="-1">Hydrators and Metadata Sources <a class="header-anchor" href="#hydrators-and-metadata-sources" aria-label="Permalink to &quot;Hydrators and Metadata Sources&quot;">​</a></h2><p>The generator hydrates metadata from several sources:</p><ol><li><code>@tachui/modifiers</code> — runtime modifier factories (<code>registerModifiers</code>)</li><li><code>@tachui/devtools</code> — detailed modifier signatures, descriptions, and categories (<code>registerModifierMetadata</code>)</li><li>Extra modules specified via the environment variable <code>TACHUI_TYPEGEN_HYDRATORS</code> or the <code>extraModules</code>/<code>extraHydrators</code> options in the CLI and Vite plugin</li></ol><p>If you ship a custom package that registers modifiers, expose a function similar to <code>registerModifierMetadata</code> and add it via <code>TACHUI_TYPEGEN_HYDRATORS</code> (CLI) or <code>extraHydrators</code> (Vite plugin).</p><p>When metadata lives outside the workspace paths the generator hydrates by default, you can explicitly point to the module:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">TACHUI_TYPEGEN_HYDRATORS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">../../apps/demo/src/register-modifiers.ts</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  pnpm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --filter</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @tachui/core</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> generate-modifier-types</span></span></code></pre></div><p>Multiple hydrators can be supplied by comma separating the paths.</p><h2 id="conflict-handling" tabindex="-1">Conflict Handling <a class="header-anchor" href="#conflict-handling" aria-label="Permalink to &quot;Conflict Handling&quot;">​</a></h2><p>When two plugins register metadata for the same modifier name <strong>with the same priority</strong>, the generator records a conflict. By default, conflicts produce a warning alongside the JSON snapshot. To hard fail:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --filter</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @tachui/core</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> generate-modifier-types</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --fail-on-conflict</span></span></code></pre></div><p>or specify <code>failOnConflict: true</code> in the Vite plugin options.</p><h2 id="troubleshooting" tabindex="-1">Troubleshooting <a class="header-anchor" href="#troubleshooting" aria-label="Permalink to &quot;Troubleshooting&quot;">​</a></h2><ul><li><p><strong>“stale files” during <code>--check</code></strong><br> Run <code>pnpm --filter @tachui/core generate-modifier-types</code> to refresh files before re-running <code>--check</code>.</p></li><li><p><strong>“module not found” errors</strong><br> Ensure you are running the commands from the repository root (the generator relies on workspace-relative path aliases).</p></li><li><p><strong>“Total modifiers: 0” in the summary</strong><br> No metadata hydrators executed before <code>generateModifierTypes()</code> ran. Confirm <code>@tachui/modifiers</code> and <code>@tachui/devtools</code> are available or supply hydrator paths via <code>TACHUI_TYPEGEN_HYDRATORS</code>.</p></li><li><p><strong>Types not updating in the IDE</strong><br> Confirm the generated <code>.d.ts</code> file is included in your editor’s TypeScript project. After regeneration, reload the editor window if necessary.</p></li><li><p><strong>Conflicts reported unexpectedly</strong><br> Inspect <code>src/types/modifier-metadata.snapshot.json</code> to find the conflicting plugins. Adjust priority ordering or rename modifiers to avoid collisions.</p></li></ul>`,38)])])}const g=e(n,[["render",r]]);export{k as __pageData,g as default};
